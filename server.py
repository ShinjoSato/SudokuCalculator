# -*- coding: utf-8 -*-
import http.server as server
import json
from src.main import main

class SudokuHandler(server.BaseHTTPRequestHandler):
    def do_POST(self):

        # リクエスト取得
        content_len  = int(self.headers.get("content-length"))
        body = json.loads(self.rfile.read(content_len))

        #main(body)

        # レスポンス処理
        result=main(body)
        response={
            'comment': 'It works!\nThank you!',
            'result': result
        }
        
        self.send_response(200)
        self.send_header('Content-type', 'application/json;')
        self.end_headers()
        body_json = json.dumps(response, sort_keys=False, indent=4, ensure_ascii=False) 
        self.wfile.write(body_json.encode("utf-8"))



# サーバ起動
host = '0.0.0.0'
port = 3333
httpd = server.HTTPServer((host, port), SudokuHandler)
httpd.serve_forever()


"""
## References
- https://qiita.com/tkj/items/1338ad081038fa64cef8

## Command
### Check port numbers on MacOS
```sh
lsof -i -P | grep "LISTEN"
```


- Sudoku

curl -XPOST 'http://localhost:3333/test' -d '{"type": "sudoku","matrix":[[0,1,0,  0,5,0,  0,2,0],[5,0,0,  6,0,3,  0,0,7],[0,3,0,  0,0,0,  0,1,0],[7,0,0,  0,0,0,  0,0,2],[0,5,0,  2,0,4,  0,9,0],[0,2,0,  0,0,0,  0,8,0],[4,0,0,  0,0,0,  0,0,5],[9,0,0,  5,0,2,  0,0,8],[0,7,5,  0,4,0,  9,3,0]]}'

- Duplication 

curl -XPOST 'http://localhost:3333/test' -d '{"type": "duplicate", "matrix": [[[6,0,1,  0,0,3,  0,0,5],[0,5,0,  1,9,0,  8,0,0],[3,0,0,  0,7,0,  0,0,9],[0,0,3,  0,0,9,  0,6,0],[1,0,6,  0,3,0,  0,5,2],[0,4,0,  6,0,1,  0,0,0],[8,3,0,  0,6,0,  0,0,0],[0,0,5,  0,0,7,  0,0,0],[2,0,0,  3,0,0,  0,0,0]],[[0,0,0,  0,0,6,  0,0,8],[0,0,0,  2,0,0,  5,0,0],[0,0,0,  0,1,0,  0,9,6],[0,0,0,  1,0,8,  0,6,0],[1,3,0,  0,7,0,  8,0,9],[0,7,0,  6,0,0,  1,0,0],[4,0,0,  0,6,0,  0,0,5],[0,0,5,  0,9,1,  0,4,0],[2,0,0,  8,0,0,  3,0,1]]], "group": [[[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [1,0,0],[1,0,1],[1,0,2]],[[],[],[],  [],[],[],  [1,1,0],[1,1,1],[1,1,2]],[[],[],[],  [],[],[],  [1,2,0],[1,2,1],[1,2,2]]],[[[0,6,6],[0,6,7],[0,6,8],  [],[],[],  [],[],[]],[[0,7,6],[0,7,7],[0,7,8],  [],[],[],  [],[],[]],[[0,8,6],[0,8,7],[0,8,8],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]],[[],[],[],  [],[],[],  [],[],[]]]]}'

- Abs1

curl -XPOST 'http://localhost:3333/test' -d '{"type":"abs1", "matrix":[[0,1,0,  8,0,0,  0,0,0],[0,0,0,  2,3,7,  0,5,0],[0,5,2,  0,0,0,  0,0,4],[0,0,0,  7,0,0,  0,0,8],[0,0,1,  0,0,0,  4,0,0],[5,0,0,  0,0,6,  0,0,0],[6,0,0,  0,0,0,  8,1,0],[0,3,0,  5,7,8,  0,0,0],[0,0,0,  0,0,9,  0,4,0]],"group":[[[0,0],[1,0]],  [[0,2],[1,2]],  [[0,2],[0,3]],  [[0,4],[0,5]],  [[0,7],[0,8]],[[0,8],[1,8]],  [[1,1],[2,1]],  [[2,0],[3,0]],  [[2,1],[3,1]],  [[2,3],[3,3]],[[2,6],[2,7]],  [[3,6],[3,7]],  [[3,4],[4,4]],  [[4,0],[4,1]],  [[4,4],[4,5]],[[4,5],[4,6]],  [[4,7],[4,8]],  [[4,7],[4,8]],  [[5,1],[5,2]],  [[5,2],[5,3]],[[5,3],[6,3]],  [[6,3],[6,4]],  [[6,8],[7,8]],  [[7,0],[8,0]],  [[7,1],[7,2]],[[6,2],[7,2]],  [[7,2],[7,3]],  [[7,4],[8,4]],  [[8,1],[8,2]],  [[8,6],[8,7]],[[8,7],[8,8]]]}'

- Chain

curl -XPOST 'http://localhost:3333/test' -d '{"type": "chain", "matrix": [[1,0,0,  0,0,0],[0,0,0,  0,0,1],[4,0,0,  0,0,0],[0,0,6,  0,0,2],[0,0,0,  0,0,0],[5,0,0,  3,0,0]],"group":[[[0,0], [0,1], [1,1], [2,0], [2,2], [3,3]],[[0,3], [0,4], [0,5], [1,4], [2,3], [2,5]],[[1,0], [2,1], [1,2], [3,0], [3,2], [4,1]],[[0,2], [1,3], [2,4], [1,5], [3,5], [4,4]],[[3,1], [4,0], [5,0], [5,1], [5,2], [4,2]],[[3,4], [4,3], [5,3], [5,4], [5,5], [4,5]]]}'

- Cross

curl -XPOST 'http://localhost:3333/test' -d '{"type":"cross","matrix":[[0,1,0,  0,5,0,  0,2,0],[5,0,0,  6,0,3,  0,0,7],[0,3,0,  0,0,0,  0,1,0],[7,0,0,  0,0,0,  0,0,2],[0,5,0,  2,0,4,  0,9,0],[0,2,0,  0,0,0,  0,8,0],[4,0,0,  0,0,0,  0,0,5],[9,0,0,  5,0,2,  0,0,8],[0,7,5,  0,4,0,  9,3,0]]}'

- Inequality

curl -XPOST 'http://localhost:3333/test' -d '{"type":"inequal","matrix":[[0,0,0,  0,0,0],[0,0,0,  2,0,0],[0,0,0,  0,2,0],[0,6,0,  0,0,0],[0,0,6,  0,0,0],[0,0,0,  0,0,0]], "group":[[-1, 1, 1, -1, 1],[-1, 1, -1, -1, 1, -1],[1, -1, -1, 1, -1],[1, -1, 1, 1, -1, -1],[-1, 1, -1, -1, -1],[-1, 1, -1, 1, 1, 1],[1, -1, 1, -1, -1],[-1, -1, 1, -1, 1, 1],[-1, 1, -1, 1, -1],[1, 1, -1, -1, -1, 1],[-1, -1, -1, 1, 1]]}'

- TwoTone

curl -XPOST 'http://localhost:3333/test' -d '{"type":"twotone","matrix":[[0,0,0,  9,0,0,  0,0,4],[0,0,7,  0,2,0,  0,3,0],[1,0,0,  7,0,5,  0,0,9],[0,8,0,  0,0,0,  0,9,0],[7,0,9,  0,1,0,  3,0,2],[0,6,0,  0,0,0,  0,1,0],[9,0,0,  4,0,2,  0,0,8],[0,4,0,  0,8,0,  9,0,0],[2,0,0,  0,0,6,  0,0,0]],"group":[[0,0,0,  0,0,1,  1,0,0],[0,1,0,  1,0,0,  0,0,0],[0,0,1,  0,1,0,  0,0,0],[0,0,0,  1,0,0,  0,0,2],[0,1,0,  0,0,0,  0,2,0],[1,0,0,  0,0,2,  0,0,0],[0,0,0,  0,2,0,  2,0,0],[0,0,0,  0,0,2,  0,2,0],[0,0,2,  2,0,0,  0,0,0]]}'

- Zigzag

curl -XPOST 'http://localhost:3333/test' -d '{"type":"zigzag","matrix":[[0,5,0,  7,0,1,  0,2,0],[0,0,3,  0,2,0,  9,0,0],[0,3,0,  0,0,0,  0,7,0],[7,0,0,  2,0,9,  0,0,3],[0,4,5,  0,0,0,  1,9,0],[6,0,0,  9,0,4,  0,0,1],[3,0,6,  0,9,0,  4,0,5],[0,7,0,  4,0,6,  0,1,0],[1,0,0,  0,8,0,  0,0,2]],"group":[[1,1,1,  1,2,3,  3,3,3],[4,1,2,  2,2,2,  2,3,5],[4,1,1,  1,2,3,  3,3,5],[4,4,4,  1,2,3,  5,5,5],[4,6,4,  4,2,5,  5,9,5],[6,6,6,  4,7,5,  9,9,9],[6,7,7,  7,7,7,  7,7,9],[6,8,8,  8,7,8,  8,8,9],[6,6,6,  8,8,8,  9,9,9]]}'

O curl -XPOST 'http://localhost:3333/test' -d '{ "question": "Weather is" }'
X curl -XPOST 'http://localhost:3333/test' -d "{ 'question': 'Weather is' }"
"""